<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPMN Analyzer Pro - Debug Mode</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        .error {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }
        .success {
            background: #e8f5e8;
            border-color: #4caf50;
            color: #2e7d32;
        }
        .info {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #1565c0;
        }
        .warning {
            background: #fff3e0;
            border-color: #ff9800;
            color: #e65100;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .test-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover {
            background: #1976d2;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #ccc;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç BPMN Analyzer Pro - Debug Mode</h1>
        
        <div class="section info">
            <h2>üìä System Information</h2>
            <div id="system-info">
                <p>Loading system information...</p>
            </div>
        </div>

        <div class="section">
            <h2>üß™ Module Tests</h2>
            <button class="test-btn" onclick="testCSS()">Test CSS Loading</button>
            <button class="test-btn" onclick="testJavaScript()">Test JavaScript Modules</button>
            <button class="test-btn" onclick="testDOM()">Test DOM Elements</button>
            <button class="test-btn" onclick="testEventListeners()">Test Event Listeners</button>
            <button class="test-btn" onclick="testFullApp()">Test Full App</button>
        </div>

        <div class="section">
            <h2>üìù Console Logs</h2>
            <div id="console-logs">
                <p>Console logs will appear here...</p>
            </div>
        </div>

        <div class="section">
            <h2>üîß Error Details</h2>
            <div id="error-details">
                <p>No errors detected yet...</p>
            </div>
        </div>

        <div class="section">
            <h2>üì¶ Asset Loading</h2>
            <div id="asset-loading">
                <p>Checking asset loading...</p>
            </div>
        </div>
    </div>

    <script>
        // Debug Logger
        class DebugLogger {
            constructor() {
                this.logs = [];
                this.errors = [];
                this.originalConsole = {
                    log: console.log,
                    error: console.error,
                    warn: console.warn,
                    info: console.info
                };
                this.setupConsoleCapture();
            }

            setupConsoleCapture() {
                console.log = (...args) => {
                    this.originalConsole.log(...args);
                    this.addLog('log', args);
                };
                
                console.error = (...args) => {
                    this.originalConsole.error(...args);
                    this.addLog('error', args);
                };
                
                console.warn = (...args) => {
                    this.originalConsole.warn(...args);
                    this.addLog('warn', args);
                };
                
                console.info = (...args) => {
                    this.originalConsole.info(...args);
                    this.addLog('info', args);
                };
            }

            addLog(type, args) {
                const logEntry = {
                    type,
                    message: args.map(arg => 
                        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                    ).join(' '),
                    timestamp: new Date().toISOString(),
                    stack: type === 'error' ? new Error().stack : null
                };
                
                this.logs.push(logEntry);
                if (type === 'error') {
                    this.errors.push(logEntry);
                }
                this.updateDisplay();
            }

            updateDisplay() {
                const consoleDiv = document.getElementById('console-logs');
                const errorDiv = document.getElementById('error-details');
                
                // Update console logs
                const recentLogs = this.logs.slice(-20);
                consoleDiv.innerHTML = recentLogs.map(log => 
                    `<div class="log-entry" style="border-left-color: ${this.getColorForType(log.type)}">
                        <strong>[${log.type.toUpperCase()}]</strong> ${log.timestamp}<br>
                        <pre>${log.message}</pre>
                    </div>`
                ).join('');

                // Update errors
                if (this.errors.length > 0) {
                    errorDiv.innerHTML = this.errors.map(error => 
                        `<div class="log-entry error">
                            <strong>ERROR:</strong> ${error.timestamp}<br>
                            <pre>${error.message}</pre>
                            ${error.stack ? `<pre>${error.stack}</pre>` : ''}
                        </div>`
                    ).join('');
                }
            }

            getColorForType(type) {
                const colors = {
                    log: '#2196f3',
                    error: '#f44336',
                    warn: '#ff9800',
                    info: '#4caf50'
                };
                return colors[type] || '#666';
            }
        }

        // Initialize debug logger
        const debugLogger = new DebugLogger();

        // System Information
        function updateSystemInfo() {
            const systemInfo = document.getElementById('system-info');
            systemInfo.innerHTML = `
                <p><strong>Browser:</strong> ${navigator.userAgent}</p>
                <p><strong>Platform:</strong> ${navigator.platform}</p>
                <p><strong>Language:</strong> ${navigator.language}</p>
                <p><strong>Screen Resolution:</strong> ${screen.width}x${screen.height}</p>
                <p><strong>URL:</strong> ${window.location.href}</p>
                <p><strong>Document Ready:</strong> ${document.readyState}</p>
                <p><strong>jQuery Available:</strong> ${typeof $ !== 'undefined' ? 'Yes' : 'No'}</p>
            `;
        }

        // Test Functions
        function testCSS() {
            console.log('üß™ Testing CSS Loading...');
            
            // Test if main.css is loaded
            const mainCSS = document.querySelector('link[href*="main.css"]');
            if (mainCSS) {
                console.log('‚úÖ main.css found in DOM');
            } else {
                console.error('‚ùå main.css not found in DOM');
            }

            // Test CSS variables
            const testElement = document.createElement('div');
            testElement.style.display = 'none';
            document.body.appendChild(testElement);
            testElement.style.color = 'var(--color-primary)';
            const computedColor = getComputedStyle(testElement).color;
            document.body.removeChild(testElement);
            
            if (computedColor && computedColor !== 'rgb(0, 0, 0)') {
                console.log('‚úÖ CSS variables working:', computedColor);
            } else {
                console.error('‚ùå CSS variables not working');
            }
        }

        function testJavaScript() {
            console.log('üß™ Testing JavaScript Modules...');
            
            // Test module imports
            try {
                import('./src/main.js').then(module => {
                    console.log('‚úÖ main.js loaded successfully');
                }).catch(error => {
                    console.error('‚ùå main.js failed to load:', error);
                });
            } catch (error) {
                console.error('‚ùå Module import error:', error);
            }

            // Test if global objects exist
            const globalChecks = [
                'document',
                'window',
                'console',
                'localStorage',
                'sessionStorage'
            ];
            
            globalChecks.forEach(check => {
                if (typeof window[check] !== 'undefined') {
                    console.log(`‚úÖ ${check} available`);
                } else {
                    console.error(`‚ùå ${check} not available`);
                }
            });
        }

        function testDOM() {
            console.log('üß™ Testing DOM Elements...');
            
            // Check if app container exists
            const appContainer = document.getElementById('app');
            if (appContainer) {
                console.log('‚úÖ #app container found');
            } else {
                console.error('‚ùå #app container not found');
            }

            // Check for essential elements
            const essentialElements = [
                '#drop-zone',
                '#file-input',
                '#progress-container',
                '#dashboard-section'
            ];
            
            essentialElements.forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    console.log(`‚úÖ ${selector} found`);
                } else {
                    console.error(`‚ùå ${selector} not found`);
                }
            });
        }

        function testEventListeners() {
            console.log('üß™ Testing Event Listeners...');
            
            // Test click events
            document.addEventListener('click', function(e) {
                console.log('üñ±Ô∏è Click detected:', e.target);
            }, { once: true });

            // Test drag events
            const dropZone = document.getElementById('drop-zone');
            if (dropZone) {
                dropZone.addEventListener('dragover', function(e) {
                    console.log('üìÅ Drag over detected');
                });
                
                dropZone.addEventListener('drop', function(e) {
                    console.log('üìÅ Drop detected');
                });
            }
        }

        function testFullApp() {
            console.log('üß™ Testing Full App...');
            
            // Try to load the actual app
            const script = document.createElement('script');
            script.type = 'module';
            script.src = './src/main.js';
            script.onload = function() {
                console.log('‚úÖ App script loaded');
            };
            script.onerror = function(error) {
                console.error('‚ùå App script failed to load:', error);
            };
            document.head.appendChild(script);
        }

        // Asset Loading Test
        function checkAssetLoading() {
            const assetDiv = document.getElementById('asset-loading');
            const assets = [
                './src/styles/main.css',
                './src/main.js',
                './index.html'
            ];
            
            let html = '<h3>Asset Status:</h3>';
            
            assets.forEach(asset => {
                fetch(asset, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            html += `<p style="color: green">‚úÖ ${asset} - ${response.status}</p>`;
                        } else {
                            html += `<p style="color: red">‚ùå ${asset} - ${response.status}</p>`;
                        }
                        assetDiv.innerHTML = html;
                    })
                    .catch(error => {
                        html += `<p style="color: red">‚ùå ${asset} - Network Error</p>`;
                        assetDiv.innerHTML = html;
                    });
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Debug page loaded');
            updateSystemInfo();
            checkAssetLoading();
        });

        // Global error handler
        window.addEventListener('error', function(e) {
            console.error('üö® Global error:', e.error);
        });

        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', function(e) {
            console.error('üö® Unhandled promise rejection:', e.reason);
        });
    </script>
</body>
</html>
